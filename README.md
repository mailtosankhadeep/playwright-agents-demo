# Playwright Agents Demo

Automated UI testing playground for [practice-automation.com](https://practice-automation.com) using Playwright. The project mixes traditional Playwright specs with Cucumber BDD scenarios (implemented in TypeScript) and captures Playwright traces for every BDD run.

## üöÄ Quick Start: Accessing Agents

**Want to use the custom agents in this repo?** See **[ACCESSING_AGENTS.md](ACCESSING_AGENTS.md)** for a complete guide on how to:
- Enable and discover agents in VS Code
- Invoke agents through Copilot Chat
- Use agents from GitHub Issues and PRs
- Troubleshoot common issues

## Prerequisites
- Node.js 18+
- npm (bundled with Node.js)

Install project dependencies and Playwright browsers:

```powershell
npm install
npx playwright install
```

## Project Structure
- `feature/` ‚Äì Gherkin feature files
- `step-definition/` ‚Äì Cucumber step definitions written in TypeScript
- `test-results/` ‚Äì Playwright trace archives generated by BDD runs
- `seed.spec.ts` ‚Äì placeholder spec produced by `playwright init-agents`
- `.vscode/mcp.json` ‚Äì configuration for the Playwright MCP server

## Scripts
Run the default Playwright test runner:
```powershell
npm run test
```

Execute all BDD scenarios headless:
```powershell
npm run bdd
```

Execute all BDD scenarios headed (shows the browser):
```powershell
npm run bdd:headed
```

Each BDD run automatically records a Playwright trace under `test-results/trace-<timestamp>.zip`.

## Inspecting Traces
Open any saved trace with the Playwright trace viewer:
```powershell
npx playwright show-trace test-results/trace-<timestamp>.zip
```

## Customising
- Set `TRACE_DIR` to change where trace files are saved.
- Toggle headed mode manually by setting `HEADED=1` before running `npm run bdd`.
- Extend the `.feature` files and add matching step definitions in TypeScript to grow your test suite.

## Playwright Agents (MCP) Configuration
This project is pre-wired to work with GitHub Copilot Playwright Agents via the Model Context Protocol (MCP).

1. Ensure dependencies are installed (`npm install`) and Playwright browsers are available (`npx playwright install`).
2. Keep the MCP configuration at `.vscode/mcp.json`:
	 ```json
	 {
		 "servers": {
			 "playwright-test": {
				 "type": "stdio",
				 "command": "npx",
				 "args": ["playwright", "run-test-mcp-server"]
			 }
		 },
		 "inputs": []
	 }
	 ```
3. Reload VS Code (Command Palette ‚Üí `Developer: Reload Window`) so Copilot can register the server.
4. In Copilot Chat, request Playwright actions (e.g., "Run Playwright tests" or "Open the last trace"). The MCP server will broker those commands using the local Playwright install.

### Jira MCP Server

Copilot can also connect to Jira through the MCP server defined in `mcp/jira-server.ts`.

1. Populate a `.env` file (or export variables in your shell) with:
	```ini
	JIRA_BASE_URL=https://your-domain.atlassian.net
	JIRA_EMAIL=your.email@example.com
	JIRA_API_TOKEN=your_api_token
	```
	Tokens can be created from [https://id.atlassian.com/manage-profile/security/api-tokens](https://id.atlassian.com/manage-profile/security/api-tokens).
2. Ensure `ts-node` is available (installed via `npm install`).
3. The `.vscode/mcp.json` already registers the Jira server via `npx ts-node --transpile-only mcp/jira-server.ts`.
4. Ask Copilot Chat to "Search Jira issues" or "Get Jira issue ABC-123"‚Äîit will call the `jira.search` and `jira.get` tools exposed by the server.

Errors from Jira (e.g., missing permissions) are surfaced directly in Copilot for quick troubleshooting.

### Agent HQ Monitoring MCP Server

Monitor Agent HQ activities, workflows, and performance through the monitoring server defined in `mcp/agent-hq-monitor-server.ts`.

1. The monitoring server is automatically configured in `.vscode/mcp.json`.
2. No additional setup required‚Äîmonitoring is optional and can be enabled on-demand.
3. Ask Copilot Chat to:
   - "Show Agent HQ status"
   - "Display agent performance metrics"
   - "Show recent workflows"
   - "What agents have been invoked today?"
4. Monitoring logs are stored in the `logs/` directory (automatically created when needed).
5. The monitoring server exposes tools like `agentHQ.getStatus`, `agentHQ.getMetrics`, and `agentHQ.getRecentActivities`.

üìñ **[Complete monitoring documentation](docs/agent-hq-monitoring.md)** includes detailed usage, troubleshooting, and best practices.

### Installing Playwright Agent Chat Modes (Planner, Generator, Healer)

Install the Playwright Agent chat modes once per workspace to populate `.github/chatmodes/` for Copilot.

```powershell
npx playwright init-agents --loop=vscode
```

The command installs or updates the Planner, Generator, and Healer chat mode definitions so Copilot can orchestrate those agents.

If you prefer non-interactive startup, adjust the args to `"args": ["--yes", "playwright", "run-test-mcp-server"]` so `npx` skips prompts.

## Custom Agents

This repository includes specialized custom agents in `.github/agents/` that extend Copilot's capabilities.

üìö **[Complete Guide: ACCESSING_AGENTS.md](ACCESSING_AGENTS.md)** - Step-by-step instructions for enabling, discovering, and using all agents.

### Enabling Custom Agents in VS Code

Custom agents are automatically discovered when the proper VS Code settings are configured. This repository includes `.vscode/settings.json` with the following configuration:

```json
{
  "chat.agent.enabled": true,
  "github.copilot.chat.agents.enabled": true,
  "chat.modeFilesLocations": {
    ".github/agents": true
  },
  "chat.useAgentsMdFile": true,
  "chat.useNestedAgentsMdFiles": true,
  "chat.commandCenter.enabled": true
}
```

After cloning the repository:
1. Ensure GitHub Copilot extension is installed and enabled
2. Reload VS Code (Command Palette ‚Üí `Developer: Reload Window`)
3. Custom agents will appear in the Copilot Chat agents dropdown

### Available Custom Agents

### Agent HQ üè¢

**Agent HQ** is the central command center for orchestrating all Playwright agents and workflows. It serves as an intelligent router and coordinator that helps you:

- **Discover the right agent**: Automatically routes your requests to the appropriate specialized agent (Planner, Generator, Healer, or Test Designer)
- **Orchestrate workflows**: Coordinates complex multi-agent workflows (e.g., Plan ‚Üí Generate ‚Üí Heal)
- **Monitor status**: Provides overview of test suite health and agent activities
- **Simplify testing**: Single entry point for all testing needs

**Example usage:**
```
"I need to test our new checkout flow" ‚Üí Routes to Planner, then Generator
"Fix all failing tests" ‚Üí Runs tests, then routes failures to Healer
"Convert Jira story SCRUM-10 to tests" ‚Üí Routes to Test Designer
"What testing agents are available?" ‚Üí Shows agent catalog
"Show me Agent HQ status" ‚Üí Displays system health and metrics
```

üìñ **[Read the complete Agent HQ Usage Guide](docs/agent-hq-guide.md)** for detailed examples and workflows.

üìä **[Learn about Agent HQ Monitoring](docs/agent-hq-monitoring.md)** to track agent activities and performance.

### Test Designer üé®

**Test Designer** bridges Jira and automated testing by:
- Pulling Jira user stories and converting them to BDD scenarios
- Orchestrating Generator to create Playwright step definitions
- Handing off to Healer if tests need fixes
- Maintaining traceability between Jira stories and test code

Requires Jira environment variables (`JIRA_BASE_URL`, `JIRA_EMAIL`, `JIRA_API_TOKEN`).

## GitHub Setup
This repository is ready for GitHub pushes. Use the provided `.gitignore` to keep dependencies, build artefacts, and IDE files out of version control.
